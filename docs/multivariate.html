<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>15 Multivariate | 30-day Chart Challenge</title>
<meta name="author" content="Lisa DeBruine">
<meta name="description" content="I wrote faux to make it easier to simulate multivariate normal distribution data with different patterns of correlations, because I was doing it manually using mvrnorm() so often. It's expanded to...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="15 Multivariate | 30-day Chart Challenge">
<meta property="og:type" content="book">
<meta property="og:url" content="https://debruine.github.io/30-day-chart-challenge/multivariate.html">
<meta property="og:image" content="https://debruine.github.io/30-day-chart-challenge/images/logos/logo.png">
<meta property="og:description" content="I wrote faux to make it easier to simulate multivariate normal distribution data with different patterns of correlations, because I was doing it manually using mvrnorm() so often. It's expanded to...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="15 Multivariate | 30-day Chart Challenge">
<meta name="twitter:description" content="I wrote faux to make it easier to simulate multivariate normal distribution data with different patterns of correlations, because I was doing it manually using mvrnorm() so often. It's expanded to...">
<meta name="twitter:image" content="https://debruine.github.io/30-day-chart-challenge/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.20/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><script src="libs/rglWebGL-binding-0.108.3/rglWebGL.js"></script><link href="libs/rglwidgetClass-0.108.3/rgl.css" rel="stylesheet">
<script src="libs/rglwidgetClass-0.108.3/rglClass.min.js"></script><script src="libs/CanvasMatrix4-0.108.3/CanvasMatrix.min.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="2022">30-day Chart Challenge</a>:
        <small class="text-muted">2022</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li class="book-part">Comparisons</li>
<li><a class="" href="part-to-whole.html"><span class="header-section-number">1</span> Part-to-whole</a></li>
<li><a class="" href="pictogram.html"><span class="header-section-number">2</span> Pictogram</a></li>
<li><a class="" href="historical.html"><span class="header-section-number">3</span> Historical</a></li>
<li><a class="" href="flora.html"><span class="header-section-number">4</span> Flora</a></li>
<li><a class="" href="slope.html"><span class="header-section-number">5</span> Slope</a></li>
<li><a class="" href="owid.html"><span class="header-section-number">6</span> OWiD</a></li>
<li class="book-part">Distributions</li>
<li><a class="" href="physical.html"><span class="header-section-number">7</span> Physical</a></li>
<li><a class="" href="mountains.html"><span class="header-section-number">8</span> Mountains</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">9</span> Statistics</a></li>
<li><a class="" href="experimental.html"><span class="header-section-number">10</span> Experimental</a></li>
<li><a class="" href="circular.html"><span class="header-section-number">11</span> Circular</a></li>
<li><a class="" href="the-economist.html"><span class="header-section-number">12</span> The Economist</a></li>
<li class="book-part">Relationships</li>
<li><a class="" href="correlation.html"><span class="header-section-number">13</span> Correlation</a></li>
<li><a class="" href="dimensional.html"><span class="header-section-number">14</span> 3-dimensional</a></li>
<li><a class="active" href="multivariate.html"><span class="header-section-number">15</span> Multivariate</a></li>
<li><a class="" href="environment.html"><span class="header-section-number">16</span> Environment</a></li>
<li><a class="" href="connections.html"><span class="header-section-number">17</span> Connections</a></li>
<li><a class="" href="oecd.html"><span class="header-section-number">18</span> OECD</a></li>
<li class="book-part">Timeseries</li>
<li><a class="" href="global-challenge.html"><span class="header-section-number">19</span> Global Challenge</a></li>
<li><a class="" href="new-tool.html"><span class="header-section-number">20</span> New Tool</a></li>
<li><a class="" href="downupwards.html"><span class="header-section-number">21</span> Down/Upwards</a></li>
<li><a class="" href="animation.html"><span class="header-section-number">22</span> Animation</a></li>
<li><a class="" href="tiles.html"><span class="header-section-number">23</span> Tiles</a></li>
<li><a class="" href="financial-times.html"><span class="header-section-number">24</span> Financial Times</a></li>
<li class="book-part">Uncertainties</li>
<li><a class="" href="trend.html"><span class="header-section-number">25</span> Trend</a></li>
<li><a class="" href="interactive.html"><span class="header-section-number">26</span> Interactive</a></li>
<li><a class="" href="future.html"><span class="header-section-number">27</span> Future</a></li>
<li><a class="" href="deviations.html"><span class="header-section-number">28</span> Deviations</a></li>
<li><a class="" href="storytelling.html"><span class="header-section-number">29</span> Storytelling</a></li>
<li><a class="" href="un-population.html"><span class="header-section-number">30</span> UN Population</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="colours.html"><span class="header-section-number">A</span> Colours</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/debruine/30-day-chart-challenge">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="multivariate" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> Multivariate<a class="anchor" aria-label="anchor" href="#multivariate"><i class="fas fa-link"></i></a>
</h1>
<p>I wrote <code class="package">faux</code> to make it easier to simulate multivariate normal distribution data with different patterns of correlations, because I was doing it manually using <code>mvrnorm()</code> so often. It's expanded to a whole package dedicated to making simulation easier, focussing on simulation from the kinds of parameters you might find in the descriptives table of a paper.</p>
<p>I'll be using the new NORTA (NORmal-To-Anything) methods for today's chart, which are currently only in the development version of faux, so you need to download the GitHub version, not 1.1.0 on CRAN. You can see a <a href="https://debruine.github.io/faux/dev/articles/norta.html">tutorial here</a>.</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># devtools::install_github("debruine/faux")</span>
<span class="co"># devtools::install_github("debruine/webmorphR")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux">faux</a></span><span class="op">)</span>      <span class="co"># for data simulation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>   <span class="co"># for plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/daattali/ggExtra">ggExtra</a></span><span class="op">)</span>   <span class="co"># for margin plots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span> <span class="co"># for combining plots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/webmorphR">webmorphR</a></span><span class="op">)</span> <span class="co"># for figure making from images</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="simulate-data-1" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Simulate data<a class="anchor" aria-label="anchor" href="#simulate-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://rdrr.io/pkg/faux/man/rmulti.html">rmulti()</a></code> function uses simulation to determine what correlations among normally distributed variables is equivalent to the specified correlations among non-normally distributed variables, then simulates correlated data from a multivariate normal distribution and converts it to the specified distributions using quantile functions.</p>
<p>It works pretty much like <code><a href="https://rdrr.io/pkg/faux/man/rnorm_multi.html">rnorm_multi()</a></code>, with the addition of a <code>dist</code> argument where you can set the distribution and a <code>params</code> argument where you can set their parameters.</p>
<p>The code below simulates 1000 people with uniformly distributed age between 50 and 70, and the number of texts they send per day, which we'll simulated with a Poisson distribution with a mean (lambda) of 5. They're given a questionnaire with 1-7 Likert ratings, which are averaged, so the resulting scores are truncated from 1 to 7, with a mean of 3.5 and SS of 2.1. Age and texts are negatively correlated with <span class="math inline">\(r =-0.3\)</span>. Age is also negatively related to the score, <span class="math inline">\(r = -.4\)</span>, while score and texts are positively correlated <span class="math inline">\(r = 0.5\)</span>.</p>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span> <span class="co"># for reproducibility</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/rmulti.html">rmulti</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fl">1000</span>, 
  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>age <span class="op">=</span> <span class="st">"unif"</span>,
           texts <span class="op">=</span> <span class="st">"pois"</span>,
           score <span class="op">=</span> <span class="st">"truncnorm"</span><span class="op">)</span>,
  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">50</span>, max <span class="op">=</span> <span class="fl">70</span><span class="op">)</span>,
    texts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,
    score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">7</span>, mean <span class="op">=</span> <span class="fl">3.5</span>, sd <span class="op">=</span> <span class="fl">2.1</span><span class="op">)</span>
  <span class="op">)</span>,
  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="op">+</span><span class="fl">.5</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/faux/man/get_params.html">check_sim_stats</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
n
</th>
<th style="text-align:left;">
var
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
texts
</th>
<th style="text-align:right;">
score
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1000
</td>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
-0.30
</td>
<td style="text-align:right;">
-0.42
</td>
<td style="text-align:right;">
60.28
</td>
<td style="text-align:right;">
5.76
</td>
</tr>
<tr>
<td style="text-align:right;">
1000
</td>
<td style="text-align:left;">
texts
</td>
<td style="text-align:right;">
-0.30
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.45
</td>
<td style="text-align:right;">
4.92
</td>
<td style="text-align:right;">
2.10
</td>
</tr>
<tr>
<td style="text-align:right;">
1000
</td>
<td style="text-align:left;">
score
</td>
<td style="text-align:right;">
-0.42
</td>
<td style="text-align:right;">
0.45
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
3.74
</td>
<td style="text-align:right;">
1.53
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="plot-individual-distributions" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Plot individual distributions<a class="anchor" aria-label="anchor" href="#plot-individual-distributions"><i class="fas fa-link"></i></a>
</h2>
<div id="age" class="section level3" number="15.2.1">
<h3>
<span class="header-section-number">15.2.1</span> Age<a class="anchor" aria-label="anchor" href="#age"><i class="fas fa-link"></i></a>
</h3>
<p>Age is uniformly distributed from 50 to 70, so a histogram is probably most appropriate here. Why is the default histogram so ugly?</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/mv-unif1-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Oops, I forgot that the uniform distribution is continuous and we normally think of age in integers. There are about half as many 50 and 70 year olds than the other ages. You can fix that by simulating age from 50.501 to 70.499 (I can never remember which way exact .5s round, so I just make sure they won't round to 49 or 71.)</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span> <span class="co"># for reproducibility</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/rmulti.html">rmulti</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fl">1000</span>, 
  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>age <span class="op">=</span> <span class="st">"unif"</span>,
           texts <span class="op">=</span> <span class="st">"pois"</span>,
           score <span class="op">=</span> <span class="st">"truncnorm"</span><span class="op">)</span>,
  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">50</span> <span class="op">-</span> <span class="fl">.499</span>, max <span class="op">=</span> <span class="fl">70</span> <span class="op">+</span> <span class="fl">.499</span><span class="op">)</span>,
    texts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,
    score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">7</span>, mean <span class="op">=</span> <span class="fl">3.5</span>, sd <span class="op">=</span> <span class="fl">2.1</span><span class="op">)</span>
  <span class="op">)</span>,
  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="op">+</span><span class="fl">.5</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">dat</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<p>I'll also fix the histogram style.</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/mv-unif2-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="texts---poisson" class="section level3" number="15.2.2">
<h3>
<span class="header-section-number">15.2.2</span> Texts - Poisson<a class="anchor" aria-label="anchor" href="#texts---poisson"><i class="fas fa-link"></i></a>
</h3>
<p>The Poisson distribution approaches the normal when lambda gets large, which is why I set the example to a low number of texts.</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/mv-pois-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="score" class="section level3" number="15.2.3">
<h3>
<span class="header-section-number">15.2.3</span> Score<a class="anchor" aria-label="anchor" href="#score"><i class="fas fa-link"></i></a>
</h3>
<p>The truncated normal distribution for our score has a minimum value of 1 and a maximum value of 7.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/mv-trunc1-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>The default histogram isn't great for this. The first column is scores between 0.5 and 1.5, and half of those are impossible scores. Set the histogram boundary to 1 to and x-axis breaks to 1:7 to fix this. Now each bar is the number of people with scores between the breaks.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, boundary <span class="op">=</span> <span class="fl">1</span>, 
                 fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/mv-trunc-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="plot-bivariate-distributions" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Plot bivariate distributions<a class="anchor" aria-label="anchor" href="#plot-bivariate-distributions"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have a bit of a handle on the data, we can try to plot all the joint distributions.</p>
<p>First, I'll calculate a few things I'll need in all the plots. I set the limits for age and texts to ±0.5 from the actual range so that the margin histograms display like above, rather than with boundaries at the limits.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># axis limits</span>
<span class="va">age_limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">70</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">texts_limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">texts</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">score_limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span>

<span class="co"># custom colours</span>
<span class="va">age_col</span> <span class="op">&lt;-</span> <span class="st">"#D7A9E3"</span>
<span class="va">score_col</span> <span class="op">&lt;-</span> <span class="st">"#8BBEE8"</span>
<span class="va">texts_col</span> <span class="op">&lt;-</span> <span class="st">"#A8D5BA"</span>

<span class="co"># plot titles</span>
<span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  age_texts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">age</span>, <span class="va">dat</span><span class="op">$</span><span class="va">texts</span><span class="op">)</span>,
  score_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">age</span>, <span class="va">dat</span><span class="op">$</span><span class="va">score</span><span class="op">)</span>,
  texts_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">texts</span>, <span class="va">dat</span><span class="op">$</span><span class="va">score</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"r = %.2f"</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">sprintf</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Age vs Texts"</span>, <span class="st">"Score vs Age"</span>, <span class="st">"Texts vs Score"</span><span class="op">)</span>, <span class="st">" ("</span>, <span class="va">.</span>, <span class="st">")"</span><span class="op">)</span></code></pre></div>
<div id="age-vs-texts" class="section level3" number="15.3.1">
<h3>
<span class="header-section-number">15.3.1</span> Age vs Texts<a class="anchor" aria-label="anchor" href="#age-vs-texts"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/age-vs-texts-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>These are both integer values, so there is a lot of overplotting with 1000 subjects. There are a few ways to deal with this. Let's compare them.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">overplot_jitter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.2</span>, height <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Use geom_jitter()"</span><span class="op">)</span>

<span class="va">overplot_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Reduce the point alpha"</span><span class="op">)</span>

<span class="va">overplot_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_count.html">geom_count</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">..n..</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Use colour"</span><span class="op">)</span>

<span class="va">overplot_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_count.html">geom_count</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Use geom_count()"</span><span class="op">)</span>

<span class="va">overplot_2dhist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bin_2d.html">geom_bin2d</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Use geom_bin2d()"</span><span class="op">)</span>

<span class="va">overplot_density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_density_2d.html">geom_density_2d_filled</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Use geom_density_2d_filled()"</span><span class="op">)</span>

<span class="va">overplot_jitter</span> <span class="op">+</span> <span class="va">overplot_alpha</span> <span class="op">+</span> <span class="va">overplot_color</span> <span class="op">+</span>
  <span class="va">overplot_count</span> <span class="op">+</span><span class="va">overplot_2dhist</span> <span class="op">+</span> <span class="va">overplot_density</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/patchwork/man/plot_layout.html">plot_layout</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/overplot-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Now I can add the marginal distributions with <code class="package">ggExtra</code> and tidy up the plot a bit. I decided to use <code><a href="https://rdrr.io/pkg/ggplot2/man/geom_count.html">geom_count()</a></code> first, but then realised that the marginal distribution plots looked wrong because the marginal histograms were counting the number of plotted points per bin, not the number of data points. So I ended up using a combination of <code><a href="https://rdrr.io/pkg/ggplot2/man/geom_density_2d.html">geom_density_2d_filled()</a></code> and <code><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point()</a></code> with a low alpha. The marginal plots don't work unless you have some version of <code><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point()</a></code> (although you could set the alpha to 0 to make it invisible).</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">texts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_density_2d.html">geom_density_2d_filled</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_grey.html">scale_fill_grey</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, 
              color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">age_limit</span>, ylim <span class="op">=</span> <span class="va">texts_limit</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age (in years)"</span>,
       y <span class="op">=</span> <span class="st">"Number of texts sent per day"</span>,
       title <span class="op">=</span> <span class="va">titles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>

<span class="va">age_texts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggExtra/man/ggMarginal.html">ggMarginal</a></span><span class="op">(</span><span class="va">p1</span>, type <span class="op">=</span> <span class="st">"histogram"</span>, 
                        binwidth <span class="op">=</span> <span class="fl">1</span>, 
                        xparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">age_col</span><span class="op">)</span>,
                        yparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">texts_col</span>, boundary <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="va">age_texts</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/age-texts-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="score-vs-age" class="section level3" number="15.3.2">
<h3>
<span class="header-section-number">15.3.2</span> Score vs Age<a class="anchor" aria-label="anchor" href="#score-vs-age"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">score</span>, <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_density_2d.html">geom_density_2d_filled</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_grey.html">scale_fill_grey</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, 
              color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">score_limit</span>, ylim <span class="op">=</span> <span class="va">age_limit</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Age (in years)"</span>,
       x <span class="op">=</span> <span class="st">"Score on questionnaire"</span>,
       title <span class="op">=</span> <span class="va">titles</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>

<span class="va">score_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggExtra/man/ggMarginal.html">ggMarginal</a></span><span class="op">(</span><span class="va">p2</span>, type <span class="op">=</span> <span class="st">"histogram"</span>, 
                        xparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="va">score_col</span><span class="op">)</span>,
                        yparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="va">age_col</span><span class="op">)</span><span class="op">)</span>

<span class="va">score_age</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/score-age-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="texts-vs-score" class="section level3" number="15.3.3">
<h3>
<span class="header-section-number">15.3.3</span> Texts vs Score<a class="anchor" aria-label="anchor" href="#texts-vs-score"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">texts</span>, <span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_density_2d.html">geom_density_2d_filled</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_grey.html">scale_fill_grey</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, 
              color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">texts_limit</span>, ylim <span class="op">=</span> <span class="va">score_limit</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of texts sent per day"</span>,
       y <span class="op">=</span> <span class="st">"Score on questionnaire"</span>,
       title <span class="op">=</span> <span class="va">titles</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>

<span class="va">texts_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggExtra/man/ggMarginal.html">ggMarginal</a></span><span class="op">(</span><span class="va">p3</span>, type <span class="op">=</span> <span class="st">"histogram"</span>, 
                        xparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="va">texts_col</span><span class="op">)</span>,
                        yparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="va">score_col</span><span class="op">)</span><span class="op">)</span>

<span class="va">texts_score</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/texts-score-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="combine" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Combine<a class="anchor" aria-label="anchor" href="#combine"><i class="fas fa-link"></i></a>
</h2>
<p>You can't combine plots with margins made by ggExtra using patchwork, so I have to save each to a file individually and combine them with <code class="package"><a href="https://debruine.github.io/webmorphR/" target="_blank">webmorphR</a></code>.</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/mv_1_age_texts.png"</span>, <span class="va">age_texts</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/mv_2_score_age.png"</span>, <span class="va">score_age</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/mv_3_texts_score.png"</span>, <span class="va">texts_score</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>WebmorphR is an R package I'm developing for making visual stimuli for research in a way that is computationally reproducible. It uses magick under the hood, but has a lot of convenient functions for <a href="https://debruine.github.io/webmorphR/articles/figures.html">making figures</a>.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read in images starting with mv_</span>
<span class="va">imgs</span> <span class="op">&lt;-</span> <span class="fu">webmorphR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/webmorphR/man/read_stim.html">read_stim</a></span><span class="op">(</span><span class="st">"images"</span>, <span class="st">"^mv_\\d"</span><span class="op">)</span>

<span class="co"># plot in a single row</span>
<span class="va">fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">imgs</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">fig</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/day15-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Save the figure to a file.</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/webmorphR/man/write_stim.html">write_stim</a></span><span class="op">(</span><span class="va">fig</span>, dir <span class="op">=</span> <span class="st">"images"</span>, names <span class="op">=</span> <span class="st">"day15"</span>, format <span class="op">=</span> <span class="st">"png"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    license + cite
  );

  // open rdrr links externally
  $("a[href^='https://rdrr.io']").click(function(){
    window.open(this.href);
    return false;
  });

  // visible second sidebar in mobile
  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="dimensional.html"><span class="header-section-number">14</span> 3-dimensional</a></div>
<div class="next"><a href="environment.html"><span class="header-section-number">16</span> Environment</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#multivariate"><span class="header-section-number">15</span> Multivariate</a></li>
<li><a class="nav-link" href="#simulate-data-1"><span class="header-section-number">15.1</span> Simulate data</a></li>
<li>
<a class="nav-link" href="#plot-individual-distributions"><span class="header-section-number">15.2</span> Plot individual distributions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#age"><span class="header-section-number">15.2.1</span> Age</a></li>
<li><a class="nav-link" href="#texts---poisson"><span class="header-section-number">15.2.2</span> Texts - Poisson</a></li>
<li><a class="nav-link" href="#score"><span class="header-section-number">15.2.3</span> Score</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#plot-bivariate-distributions"><span class="header-section-number">15.3</span> Plot bivariate distributions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#age-vs-texts"><span class="header-section-number">15.3.1</span> Age vs Texts</a></li>
<li><a class="nav-link" href="#score-vs-age"><span class="header-section-number">15.3.2</span> Score vs Age</a></li>
<li><a class="nav-link" href="#texts-vs-score"><span class="header-section-number">15.3.3</span> Texts vs Score</a></li>
</ul>
</li>
<li><a class="nav-link" href="#combine"><span class="header-section-number">15.4</span> Combine</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/debruine/30-day-chart-challenge/blob/master/book/03-relationships.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/debruine/30-day-chart-challenge/edit/master/book/03-relationships.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>30-day Chart Challenge</strong>: 2022" was written by Lisa DeBruine. It was last built on 2022-04-15.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
