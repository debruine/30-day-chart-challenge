<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Slope | 30-day Chart Challenge</title>
<meta name="author" content="Lisa DeBruine">
<meta name="description" content="I'm going back to data simulation. Someone asked me recently how to add a continuous predictor to a mixed effects model. I'm going to build a function for simulating data with a nested structure...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="5 Slope | 30-day Chart Challenge">
<meta property="og:type" content="book">
<meta property="og:url" content="https://debruine.github.io/30-day-chart-challenge/slope.html">
<meta property="og:image" content="https://debruine.github.io/30-day-chart-challenge/images/logos/logo.png">
<meta property="og:description" content="I'm going back to data simulation. Someone asked me recently how to add a continuous predictor to a mixed effects model. I'm going to build a function for simulating data with a nested structure...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 Slope | 30-day Chart Challenge">
<meta name="twitter:description" content="I'm going back to data simulation. Someone asked me recently how to add a continuous predictor to a mixed effects model. I'm going to build a function for simulating data with a nested structure...">
<meta name="twitter:image" content="https://debruine.github.io/30-day-chart-challenge/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="2022">30-day Chart Challenge</a>:
        <small class="text-muted">2022</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li class="book-part">Comparisons</li>
<li><a class="" href="part-to-whole.html"><span class="header-section-number">1</span> Part-to-whole</a></li>
<li><a class="" href="pictogram.html"><span class="header-section-number">2</span> Pictogram</a></li>
<li><a class="" href="historical.html"><span class="header-section-number">3</span> Historical</a></li>
<li><a class="" href="flora.html"><span class="header-section-number">4</span> Flora</a></li>
<li><a class="active" href="slope.html"><span class="header-section-number">5</span> Slope</a></li>
<li><a class="" href="owid.html"><span class="header-section-number">6</span> OWiD</a></li>
<li class="book-part">Distributions</li>
<li><a class="" href="physical.html"><span class="header-section-number">7</span> Physical</a></li>
<li><a class="" href="mountains.html"><span class="header-section-number">8</span> Mountains</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">9</span> Statistics</a></li>
<li><a class="" href="experimental.html"><span class="header-section-number">10</span> Experimental</a></li>
<li><a class="" href="circular.html"><span class="header-section-number">11</span> Circular</a></li>
<li><a class="" href="the-economist.html"><span class="header-section-number">12</span> The Economist</a></li>
<li class="book-part">Relationships</li>
<li><a class="" href="correlation.html"><span class="header-section-number">13</span> Correlation</a></li>
<li><a class="" href="dimensional.html"><span class="header-section-number">14</span> 3-dimensional</a></li>
<li><a class="" href="multivariate.html"><span class="header-section-number">15</span> Multivariate</a></li>
<li><a class="" href="environment.html"><span class="header-section-number">16</span> Environment</a></li>
<li><a class="" href="connections.html"><span class="header-section-number">17</span> Connections</a></li>
<li><a class="" href="oecd.html"><span class="header-section-number">18</span> OECD</a></li>
<li class="book-part">Timeseries</li>
<li><a class="" href="global-challenge.html"><span class="header-section-number">19</span> Global Challenge</a></li>
<li><a class="" href="new-tool.html"><span class="header-section-number">20</span> New Tool</a></li>
<li><a class="" href="downupwards.html"><span class="header-section-number">21</span> Down/Upwards</a></li>
<li><a class="" href="animation.html"><span class="header-section-number">22</span> Animation</a></li>
<li><a class="" href="tiles.html"><span class="header-section-number">23</span> Tiles</a></li>
<li><a class="" href="financial-times.html"><span class="header-section-number">24</span> Financial Times</a></li>
<li class="book-part">Uncertainties</li>
<li><a class="" href="trend.html"><span class="header-section-number">25</span> Trend</a></li>
<li><a class="" href="interactive.html"><span class="header-section-number">26</span> Interactive</a></li>
<li><a class="" href="future.html"><span class="header-section-number">27</span> Future</a></li>
<li><a class="" href="deviations.html"><span class="header-section-number">28</span> Deviations</a></li>
<li><a class="" href="storytelling.html"><span class="header-section-number">29</span> Storytelling</a></li>
<li><a class="" href="un-population.html"><span class="header-section-number">30</span> UN Population</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="colours.html"><span class="header-section-number">A</span> Colours</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/debruine/30-day-chart-challenge">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="slope" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Slope<a class="anchor" aria-label="anchor" href="#slope"><i class="fas fa-link"></i></a>
</h1>
<p>I'm going back to data simulation. Someone asked me recently how to add a continuous predictor to a mixed effects model. I'm going to build a function for simulating data with a nested structure sampling people within countries and a continuous predictor of time (0-10). I'll plot the data with various values for the parameters, including random intercepts and <em>slopes</em>. If you need a refresher on mixed effects models, see <a href="https://debruine.github.io/lmem_sim/">this tutorial by Dale Barr and me</a>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux">faux</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span></code></pre></div>
<div id="data-simulation-function" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Data Simulation Function<a class="anchor" aria-label="anchor" href="#data-simulation-function"><i class="fas fa-link"></i></a>
</h2>
<p>First, I need to write a function to generate the simulated data. I want to be able to vary the fixed and random effects parameters, but am setting almost everything to 0 as a default. I'm using mixed design simulation functions from the faux package, which you can learn more about in this <a href="https://debruine.github.io/faux/articles/sim_mixed.html">vignette</a>.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">n_countries</span> <span class="op">=</span> <span class="fl">10</span>, <span class="co"># number of countries samples</span>
  <span class="va">n_people</span> <span class="op">=</span> <span class="fl">10</span>,    <span class="co"># number of people sampled per country</span>
  <span class="va">c_int_sd</span> <span class="op">=</span> <span class="fl">0</span>,     <span class="co"># SD of random intercept for countries</span>
  <span class="va">c_time_sd</span> <span class="op">=</span> <span class="fl">0</span>,    <span class="co"># SD of random slope for time (by country)</span>
  <span class="va">c_cors</span> <span class="op">=</span> <span class="fl">0</span>,       <span class="co"># correlation between c_int and c_time</span>
  <span class="va">p_int_sd</span> <span class="op">=</span> <span class="fl">0</span>,     <span class="co"># SD of random intercept for people</span>
  <span class="va">p_time_sd</span> <span class="op">=</span> <span class="fl">0</span>,    <span class="co"># SD of random slope for time (by person)</span>
  <span class="va">p_cors</span> <span class="op">=</span> <span class="fl">0</span>,       <span class="co"># correlations among p_int, p_time, p_height</span>
  <span class="va">err_sd</span> <span class="op">=</span> <span class="fl">0</span>,       <span class="co"># error SD</span>
  <span class="va">intercept</span> <span class="op">=</span> <span class="fl">0</span>,    <span class="co"># grand intercept</span>
  <span class="va">b_time</span> <span class="op">=</span> <span class="fl">0</span>        <span class="co"># fixed effect of time</span>
<span class="op">)</span><span class="op">{</span>

<span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>country <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n_countries</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>person <span class="op">=</span> <span class="va">n_people</span>, 
             .nested_in <span class="op">=</span> <span class="st">"country"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"country"</span>, 
            c_int <span class="op">=</span> <span class="va">c_int_sd</span>,
            c_time <span class="op">=</span> <span class="va">c_time_sd</span>,
            .cors <span class="op">=</span> <span class="va">c_cors</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"person"</span>, 
            p_int <span class="op">=</span> <span class="va">p_int_sd</span>, 
            p_time <span class="op">=</span> <span class="va">p_time_sd</span>, 
            .cors <span class="op">=</span> <span class="va">p_cors</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/expand.html">crossing</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">err_sd</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="va">intercept</span> <span class="op">+</span> <span class="va">c_int</span> <span class="op">+</span> <span class="va">p_int</span> <span class="op">+</span> 
           <span class="op">(</span><span class="va">b_time</span> <span class="op">+</span> <span class="va">p_time</span> <span class="op">+</span> <span class="va">c_time</span><span class="op">)</span> <span class="op">*</span> <span class="va">time</span> <span class="op">+</span> 
           <span class="va">err</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="default" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Default<a class="anchor" aria-label="anchor" href="#default"><i class="fas fa-link"></i></a>
</h2>
<p>The default plot is pretty boring. Everyone's score is is equal to the grand intercept.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/stat_summary.html">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-default-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="random-error" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Random error<a class="anchor" aria-label="anchor" href="#random-error"><i class="fas fa-link"></i></a>
</h2>
<p>We can make the simulation more realistic by adding random error.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>err_sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span>, group <span class="op">=</span> <span class="va">person</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">country</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-err-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Here are the data for each person in country A.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">person</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/stat_summary.html">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, fun <span class="op">=</span> <span class="va">mean</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">person</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-err-person-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>We're going to leave the error SD as a totally unrealistic 0 for the next few plots to make it easier to see what happens to the data when you're changing random effects parameters.</p>
</div>
<div id="random-intercepts-for-country" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Random intercepts for country<a class="anchor" aria-label="anchor" href="#random-intercepts-for-country"><i class="fas fa-link"></i></a>
</h2>
<p>Now let's add a random intercept per country. Setting c_int_sd to 1 means that the intercepts for each country are simulated to vary with an SD of 1.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>c_int_sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/stat_summary.html">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-c-int-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="random-slopes-for-country" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Random slopes for country<a class="anchor" aria-label="anchor" href="#random-slopes-for-country"><i class="fas fa-link"></i></a>
</h2>
<p>What does it look like if we leave the random intercepts at 0 and set the random slope of time for countries to 1?</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>c_time_sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/stat_summary.html">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-c-time-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="random-intercepts-and-slopes-for-country" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Random intercepts and slopes for country<a class="anchor" aria-label="anchor" href="#random-intercepts-and-slopes-for-country"><i class="fas fa-link"></i></a>
</h2>
<p>What if we set both the random intercept and slope of time for country to 1? Now, the intercepts vary around 0 and the slopes of the lines also vary.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>c_int_sd <span class="op">=</span> <span class="fl">1</span>, c_time_sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/stat_summary.html">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-c-int-time-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Random intercepts and slopes can be correlated. For example, the time effect might be larger in countries where people tend to have lower scores, leading the random slope and intercept for country to be negatively correlated.</p>
<p>I increased the SD of the random intercept to make it easier to see that countries with a higher intercept tend to have more negative slopes than those with a lower intercept.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>c_int_sd <span class="op">=</span> <span class="fl">5</span>, c_time_sd <span class="op">=</span> <span class="fl">1</span>, c_cors <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/stat_summary.html">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></code></pre></div>
<div class="inline-figure">
<img src="30DCC_files/figure-html/slope-c-int-time-cor-neg-1.png" width="100%" style="display: block; margin: auto;">
And here's the same plot with a positive correlation. Now the countries with a higher intercept tend to have a more positive effect of time.</div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>c_int_sd <span class="op">=</span> <span class="fl">5</span>, c_time_sd <span class="op">=</span> <span class="fl">1</span>, c_cors <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/stat_summary.html">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-c-int-time-cor-pos-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="random-intercepts-for-person" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Random intercepts for person<a class="anchor" aria-label="anchor" href="#random-intercepts-for-person"><i class="fas fa-link"></i></a>
</h2>
<p>If we vary the random intercepts by person, this increases the variability within each country. Note that because we're only sampling 10 people in each country, this means the intercept for each country will vary a bit depending on the mean of the 10 people from that country.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>p_int_sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-p-int-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Let's look at the data for each country separately.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span>, group <span class="op">=</span> <span class="va">person</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, size <span class="op">=</span> <span class="fl">0.5</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">country</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-p-int-country-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="random-slopes-for-person" class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> Random slopes for person<a class="anchor" aria-label="anchor" href="#random-slopes-for-person"><i class="fas fa-link"></i></a>
</h2>
<p>Vary the random slopes by person. Here, we're viewing the data for each country separately. The thick lines are the average slope for the country.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">person</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">.2</span>, 
              method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
              show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, size <span class="op">=</span> <span class="fl">1.5</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">country</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-p-time-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="fixed-effect-of-time" class="section level2" number="5.9">
<h2>
<span class="header-section-number">5.9</span> Fixed effect of time<a class="anchor" aria-label="anchor" href="#fixed-effect-of-time"><i class="fas fa-link"></i></a>
</h2>
<p>Let's add a fixed effect of time.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>b_time <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-fixed-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>That's pretty boring, so lets also add random time slopes for both country and person. Make the fixed effect of time bigger to emphasise how the average slopes by country tend to be positive, even though there is a lot of variation in the slopes for individual people.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>b_time <span class="op">=</span> <span class="fl">2</span>, c_time_sd <span class="op">=</span> <span class="fl">1</span>, p_time_sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">person</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">.2</span>, 
              method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
              show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span>, method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
              show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">country</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-fixed-rand-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="realistic-data" class="section level2" number="5.10">
<h2>
<span class="header-section-number">5.10</span> Realistic data<a class="anchor" aria-label="anchor" href="#realistic-data"><i class="fas fa-link"></i></a>
</h2>
<p>Finally, let's set all of the fixed and random effect parameters to non-zero values.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>c_int_sd <span class="op">=</span> <span class="fl">10</span>, c_time_sd <span class="op">=</span> <span class="fl">1</span>, c_cors <span class="op">=</span> <span class="fl">0.5</span>,
            p_int_sd <span class="op">=</span> <span class="fl">10</span>, p_time_sd <span class="op">=</span> <span class="fl">1</span>, p_cors <span class="op">=</span> <span class="fl">0.5</span>, 
            err_sd <span class="op">=</span> <span class="fl">5</span>, intercept <span class="op">=</span> <span class="fl">100</span>, b_time <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">dv</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">person</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">.2</span>, 
              method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
              se <span class="op">=</span> <span class="cn">FALSE</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span>, method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
              alpha <span class="op">=</span> <span class="fl">0.3</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">country</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="30DCC_files/figure-html/slope-realistic-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    license + cite
  );

  // open rdrr links externally
  $("a[href^='https://rdrr.io']").click(function(){
    window.open(this.href);
    return false;
  });

  // visible second sidebar in mobile
  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="flora.html"><span class="header-section-number">4</span> Flora</a></div>
<div class="next"><a href="owid.html"><span class="header-section-number">6</span> OWiD</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#slope"><span class="header-section-number">5</span> Slope</a></li>
<li><a class="nav-link" href="#data-simulation-function"><span class="header-section-number">5.1</span> Data Simulation Function</a></li>
<li><a class="nav-link" href="#default"><span class="header-section-number">5.2</span> Default</a></li>
<li><a class="nav-link" href="#random-error"><span class="header-section-number">5.3</span> Random error</a></li>
<li><a class="nav-link" href="#random-intercepts-for-country"><span class="header-section-number">5.4</span> Random intercepts for country</a></li>
<li><a class="nav-link" href="#random-slopes-for-country"><span class="header-section-number">5.5</span> Random slopes for country</a></li>
<li><a class="nav-link" href="#random-intercepts-and-slopes-for-country"><span class="header-section-number">5.6</span> Random intercepts and slopes for country</a></li>
<li><a class="nav-link" href="#random-intercepts-for-person"><span class="header-section-number">5.7</span> Random intercepts for person</a></li>
<li><a class="nav-link" href="#random-slopes-for-person"><span class="header-section-number">5.8</span> Random slopes for person</a></li>
<li><a class="nav-link" href="#fixed-effect-of-time"><span class="header-section-number">5.9</span> Fixed effect of time</a></li>
<li><a class="nav-link" href="#realistic-data"><span class="header-section-number">5.10</span> Realistic data</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/debruine/30-day-chart-challenge/blob/master/book/01-comparisons.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/debruine/30-day-chart-challenge/edit/master/book/01-comparisons.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>30-day Chart Challenge</strong>: 2022" was written by Lisa DeBruine. It was last built on 2022-04-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
