<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4 Flora | 30-day Chart Challenge</title>
<meta name="author" content="Lisa DeBruine">
<meta name="description" content="library(tidyverse) # always useful library(glue) # for editing SVG text library(rsvg) # to convert SVG to other formats I'm going a little off-piste today. I was inspired by all of these stock...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="4 Flora | 30-day Chart Challenge">
<meta property="og:type" content="book">
<meta property="og:url" content="https://debruine.github.io/30-day-chart-challenge/flora.html">
<meta property="og:image" content="https://debruine.github.io/30-day-chart-challenge/images/logos/logo.png">
<meta property="og:description" content="library(tidyverse) # always useful library(glue) # for editing SVG text library(rsvg) # to convert SVG to other formats I'm going a little off-piste today. I was inspired by all of these stock...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4 Flora | 30-day Chart Challenge">
<meta name="twitter:description" content="library(tidyverse) # always useful library(glue) # for editing SVG text library(rsvg) # to convert SVG to other formats I'm going a little off-piste today. I was inspired by all of these stock...">
<meta name="twitter:image" content="https://debruine.github.io/30-day-chart-challenge/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="2022">30-day Chart Challenge</a>:
        <small class="text-muted">2022</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li class="book-part">Comparisons</li>
<li><a class="" href="part-to-whole.html"><span class="header-section-number">1</span> Part-to-whole</a></li>
<li><a class="" href="pictogram.html"><span class="header-section-number">2</span> Pictogram</a></li>
<li><a class="" href="historical.html"><span class="header-section-number">3</span> Historical</a></li>
<li><a class="active" href="flora.html"><span class="header-section-number">4</span> Flora</a></li>
<li><a class="" href="slope.html"><span class="header-section-number">5</span> Slope</a></li>
<li><a class="" href="owid.html"><span class="header-section-number">6</span> OWiD</a></li>
<li class="book-part">Distributions</li>
<li><a class="" href="physical.html"><span class="header-section-number">7</span> Physical</a></li>
<li><a class="" href="mountains.html"><span class="header-section-number">8</span> Mountains</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">9</span> Statistics</a></li>
<li><a class="" href="experimental.html"><span class="header-section-number">10</span> Experimental</a></li>
<li><a class="" href="circular.html"><span class="header-section-number">11</span> Circular</a></li>
<li><a class="" href="the-economist.html"><span class="header-section-number">12</span> The Economist</a></li>
<li class="book-part">Relationships</li>
<li><a class="" href="correlation.html"><span class="header-section-number">13</span> Correlation</a></li>
<li><a class="" href="dimensional.html"><span class="header-section-number">14</span> 3-dimensional</a></li>
<li><a class="" href="multivariate.html"><span class="header-section-number">15</span> Multivariate</a></li>
<li><a class="" href="environment.html"><span class="header-section-number">16</span> Environment</a></li>
<li><a class="" href="connections.html"><span class="header-section-number">17</span> Connections</a></li>
<li><a class="" href="oecd.html"><span class="header-section-number">18</span> OECD</a></li>
<li class="book-part">Timeseries</li>
<li><a class="" href="global-challenge.html"><span class="header-section-number">19</span> Global Challenge</a></li>
<li><a class="" href="new-tool.html"><span class="header-section-number">20</span> New Tool</a></li>
<li><a class="" href="downupwards.html"><span class="header-section-number">21</span> Down/Upwards</a></li>
<li><a class="" href="animation.html"><span class="header-section-number">22</span> Animation</a></li>
<li><a class="" href="tiles.html"><span class="header-section-number">23</span> Tiles</a></li>
<li><a class="" href="financial-times.html"><span class="header-section-number">24</span> Financial Times</a></li>
<li class="book-part">Uncertainties</li>
<li><a class="" href="trend.html"><span class="header-section-number">25</span> Trend</a></li>
<li><a class="" href="interactive.html"><span class="header-section-number">26</span> Interactive</a></li>
<li><a class="" href="future.html"><span class="header-section-number">27</span> Future</a></li>
<li><a class="" href="deviations.html"><span class="header-section-number">28</span> Deviations</a></li>
<li><a class="" href="storytelling.html"><span class="header-section-number">29</span> Storytelling</a></li>
<li><a class="" href="un-population.html"><span class="header-section-number">30</span> UN Population</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="colours.html"><span class="header-section-number">A</span> Colours</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/debruine/30-day-chart-challenge">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="flora" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Flora<a class="anchor" aria-label="anchor" href="#flora"><i class="fas fa-link"></i></a>
</h1>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># always useful</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue">glue</a></span><span class="op">)</span> <span class="co"># for editing SVG text</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jeroen/rsvg">rsvg</a></span><span class="op">)</span> <span class="co"># to convert SVG to other formats</span></code></pre></div>
<p>I'm going a little off-piste today. I was inspired by all of these <a href="https://www.vectorstock.com/royalty-free-vectors/chart-flower-infographic-options-vectors">stock infographics</a>, but I wondered if I could make something similar with code. You probably can do this with ggplot and annotations, but I wanted to try something different.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"images/flower_infographics.png"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:flora-examples"></span>
<img src="images/flower_infographics.png" alt="Flower infographics from vectorstock.com" width="100%"><p class="caption">
Figure 4.1: Flower infographics from vectorstock.com
</p>
</div>
<div id="svg" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> SVG<a class="anchor" aria-label="anchor" href="#svg"><i class="fas fa-link"></i></a>
</h2>
<p>I have some experience making SVGs (scalable vector graphics), but I always have to look things up. <a href="https://www.w3schools.com/graphics/svg_intro.asp">W3Schools</a> is my favourite source for quick tutorials on web stuff. I used it a ton to make this chart.</p>
<p>While I was developing this code, I needed to have a quick look at the images a lot, and couldn't figure out an efficient way to view SVGs, so I wrote a function that converts the svg text to a PNG tempfile and displays it in my Rmd, but only when I'm running the code interactively.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">viewsvg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">svg</span>, <span class="va">width</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">height</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">dpi</span> <span class="op">=</span> <span class="fl">150</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html">interactive</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;&amp;</span>
      <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"knitr.in.progress"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">imgpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".png"</span><span class="op">)</span>
    <span class="fu">rsvg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rsvg/man/rsvg.html">rsvg_png</a></span><span class="op">(</span>svg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html">charToRaw</a></span><span class="op">(</span><span class="va">svg</span><span class="op">)</span>,
                   file <span class="op">=</span> <span class="va">imgpath</span>,
                   width <span class="op">=</span> <span class="va">width</span><span class="op">*</span><span class="va">dpi</span>, height <span class="op">=</span> <span class="va">height</span><span class="op">*</span><span class="va">dpi</span><span class="op">)</span>
    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="va">imgpath</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">svg</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>It outputs the SVG as html when knitting. All of the images below are created with a code chunk that looks like this:</p>
<div class="verbatim">
<pre class="sourceCode r"><code class="sourceCode R">```{r, results='asis', echo = FALSE}</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">viewsvg</span><span class="op">(</span><span class="va">svg</span><span class="op">)</span></code></pre></div>
<pre class="sourceCode r"><code class="sourceCode R">```</code></pre>
</div>
</div>
<div id="flower-petals" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Flower Petals<a class="anchor" aria-label="anchor" href="#flower-petals"><i class="fas fa-link"></i></a>
</h2>
<p>First, I need a function to figure out the coordinates of regular polygons.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poly_coords</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">6</span>, <span class="va">r</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">cx</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">cy</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">rot</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_dbl</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="op">~</span><span class="op">{</span> <span class="va">cx</span> <span class="op">+</span> <span class="va">r</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">.x</span> <span class="op">/</span> <span class="va">n</span> <span class="op">+</span> <span class="va">rot</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>
  <span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_dbl</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="op">~</span><span class="op">{</span> <span class="va">cy</span> <span class="op">+</span> <span class="va">r</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">.x</span> <span class="op">/</span> <span class="va">n</span> <span class="op">+</span> <span class="va">rot</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">digits</span><span class="op">)</span>,
    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">digits</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="fu">poly_coords</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></code></pre></div>
<pre><code>## $x
## [1]  1.0  0.5 -0.5 -1.0 -0.5  0.5
## 
## $y
## [1]  0.00  0.87  0.87  0.00 -0.87 -0.87</code></pre>
<p>Now, make <code>n</code> circles with radius <code>r</code> that are <code>petal_dist</code> away from the center of the flower.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="va">petal_dist</span> <span class="op">&lt;-</span> <span class="fl">300</span>
<span class="va">cx</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="va">cy</span> <span class="op">&lt;-</span> <span class="fl">500</span>

<span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu">poly_coords</span><span class="op">(</span><span class="va">n</span>, <span class="va">petal_dist</span>, <span class="va">cx</span>, <span class="va">cy</span><span class="op">)</span>
<span class="va">petals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;circle cx="{coords$x}" cy="{coords$y}" r="{r}" fill="{rainbow(n)}" /&gt;'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>

<span class="va">svg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"&lt;svg viewBox = '0 0 {2*cx} {2*cy}'&gt;"</span>,
        <span class="va">petals</span>, 
      <span class="st">"&lt;/svg&gt;"</span>,
      sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<svg viewbox="0 0 1000 1000"><circle cx="800" cy="500" r="200" fill="#FF0000"></circle><circle cx="650" cy="759.81" r="200" fill="#FFFF00"></circle><circle cx="350" cy="759.81" r="200" fill="#00FF00"></circle><circle cx="200" cy="500" r="200" fill="#00FFFF"></circle><circle cx="350" cy="240.19" r="200" fill="#0000FF"></circle><circle cx="650" cy="240.19" r="200" fill="#FF00FF"></circle></svg>
</div>
<div id="rotate" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Rotate<a class="anchor" aria-label="anchor" href="#rotate"><i class="fas fa-link"></i></a>
</h2>
<p>Rotate them so the red is at 12:00.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rot</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">pi</span><span class="op">/</span><span class="fl">2</span>

<span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu">poly_coords</span><span class="op">(</span><span class="va">n</span>, <span class="va">petal_dist</span>, <span class="va">cx</span>, <span class="va">cy</span>, <span class="va">rot</span><span class="op">)</span>
<span class="va">petals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;circle cx="{coords$x}" cy="{coords$y}" r="{r}" fill="{rainbow(n)}" /&gt;'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>

<span class="va">svg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"&lt;svg viewBox = '0 0 {2*cx} {2*cy}'&gt;"</span>,
        <span class="va">petals</span>, 
      <span class="st">"&lt;/svg&gt;"</span>,
      sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<svg viewbox="0 0 1000 1000"><circle cx="500" cy="200" r="200" fill="#FF0000"></circle><circle cx="759.81" cy="350" r="200" fill="#FFFF00"></circle><circle cx="759.81" cy="650" r="200" fill="#00FF00"></circle><circle cx="500" cy="800" r="200" fill="#00FFFF"></circle><circle cx="240.19" cy="650" r="200" fill="#0000FF"></circle><circle cx="240.19" cy="350" r="200" fill="#FF00FF"></circle></svg>
</div>
<div id="fix-the-overlap" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Fix the Overlap<a class="anchor" aria-label="anchor" href="#fix-the-overlap"><i class="fas fa-link"></i></a>
</h2>
<p>When they overlap, the last petal is on top of the first, so we need to replot the left half of that. It took me forever to figure out how to plot the left half of a circle with <code>&lt;path&gt;</code> :(</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu">poly_coords</span><span class="op">(</span><span class="va">n</span>, <span class="va">petal_dist</span>, <span class="va">cx</span>, <span class="va">cy</span>, <span class="va">rot</span><span class="op">)</span>
<span class="va">petals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;circle cx="{coords$x}" cy="{coords$y}" r="{r}" fill="{rainbow(n)}" /&gt;'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>

<span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">$</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">$</span><span class="va">y</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">petal_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;g transform="rotate({rot*180/pi}, {x1}, {y1})"&gt;
       &lt;path d="M {x1-r} {y1}
       A {r} {r} 0 0 1 {x1+r} {y1}
       L {x1-r} {y1}
       Z" 
       fill="{rainbow(n)[[1]]}" /&gt;&lt;/g&gt;'</span><span class="op">)</span>

<span class="va">svg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"&lt;svg viewBox = '0 0 {2*cx} {2*cy}'&gt;"</span>,
        <span class="va">petals</span>, <span class="va">petal_fix</span>, 
      <span class="st">"&lt;/svg&gt;"</span>,
      sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<svg viewbox="0 0 1000 1000"><circle cx="500" cy="200" r="200" fill="#FF0000"></circle><circle cx="759.81" cy="350" r="200" fill="#FFFF00"></circle><circle cx="759.81" cy="650" r="200" fill="#00FF00"></circle><circle cx="500" cy="800" r="200" fill="#00FFFF"></circle><circle cx="240.19" cy="650" r="200" fill="#0000FF"></circle><circle cx="240.19" cy="350" r="200" fill="#FF00FF"></circle><g transform="rotate(-90, 500, 200)"><path d="M 300 200
A 200 200 0 0 1 700 200
L 300 200
Z" fill="#FF0000"></path></g></svg><p>Now I want to add a center hexagon that just touches each petal.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">center</span> <span class="op">&lt;-</span> <span class="fu">poly_coords</span><span class="op">(</span><span class="va">n</span>, <span class="va">petal_dist</span><span class="op">-</span><span class="va">r</span>, <span class="va">cx</span>, <span class="va">cy</span>, <span class="va">rot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">"{cc$x},{cc$y}"</span>, cc <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'&lt;polygon points="{pts}" fill="grey" /&gt;'</span>, pts <span class="op">=</span> <span class="va">.</span><span class="op">)</span>

<span class="va">svg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"&lt;svg viewBox = '0 0 {2*cx} {2*cy}'&gt;"</span>, 
      <span class="va">center</span>,
      <span class="va">petals</span>, <span class="va">petal_fix</span>,
      <span class="st">"&lt;/svg&gt;"</span>,
      sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<svg viewbox="0 0 1000 1000"><polygon points="500,400 586.6,450 586.6,550 500,600 413.4,550 413.4,450" fill="grey"></polygon><circle cx="500" cy="200" r="200" fill="#FF0000"></circle><circle cx="759.81" cy="350" r="200" fill="#FFFF00"></circle><circle cx="759.81" cy="650" r="200" fill="#00FF00"></circle><circle cx="500" cy="800" r="200" fill="#00FFFF"></circle><circle cx="240.19" cy="650" r="200" fill="#0000FF"></circle><circle cx="240.19" cy="350" r="200" fill="#FF00FF"></circle><g transform="rotate(-90, 500, 200)"><path d="M 300 200
A 200 200 0 0 1 700 200
L 300 200
Z" fill="#FF0000"></path></g></svg>
</div>
<div id="petals" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> 7 Petals<a class="anchor" aria-label="anchor" href="#petals"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span>          <span class="op">&lt;-</span> <span class="fl">7</span>
<span class="va">rot</span>        <span class="op">&lt;-</span> <span class="fl">8.5</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">7</span>
<span class="va">petal_dist</span> <span class="op">&lt;-</span> <span class="fl">400</span>
<span class="va">r</span>          <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="va">cx</span>         <span class="op">&lt;-</span> <span class="fl">1.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">petal_dist</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span>
<span class="va">cy</span>         <span class="op">&lt;-</span> <span class="va">cx</span>

<span class="va">center</span> <span class="op">&lt;-</span> <span class="fu">poly_coords</span><span class="op">(</span><span class="va">n</span>, <span class="va">petal_dist</span><span class="op">-</span><span class="va">r</span>, <span class="va">cx</span>, <span class="va">cy</span>, <span class="va">rot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">"{cc$x},{cc$y}"</span>, cc <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'&lt;polygon points="{pts}" fill="grey" /&gt;'</span>, pts <span class="op">=</span> <span class="va">.</span><span class="op">)</span>

<span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu">poly_coords</span><span class="op">(</span><span class="va">n</span>, <span class="va">petal_dist</span>, <span class="va">cx</span>, <span class="va">cy</span>, <span class="va">rot</span><span class="op">)</span>
<span class="va">petals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;circle cx="{coords$x}" cy="{coords$y}" r="{r}" fill="{rainbow(n)}" /&gt;'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>

<span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">$</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">$</span><span class="va">y</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">petal_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;g transform="rotate({rot*180/pi}, {x1}, {y1})"&gt;
       &lt;path d="M {x1-r} {y1}
       A {r} {r} 0 0 1 {x1+r} {y1}
       L {x1-r} {y1}
       Z" 
       fill="{rainbow(n)[[1]]}" /&gt;&lt;/g&gt;'</span><span class="op">)</span>


<span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;text x="{coords$x}" y="{coords$y+40}"&gt;{LETTERS[1:n]}&lt;/text&gt;"'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>

<span class="va">svg_style</span> <span class="op">&lt;-</span> <span class="st">'&lt;style type="text/css"&gt;
svg { 
  font-family: sans-serif;
  font-size: 80px; 
  text-anchor: middle; 
  fill: white;
}
&lt;/style&gt;'</span>

<span class="va">svg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"&lt;svg viewBox = '0 0 {{2*cx}} {{2*cy}}'&gt;"</span>, 
             <span class="va">svg_style</span>,
             <span class="va">center</span>,
             <span class="st">'&lt;text x="{{cx}}" y="{{cy-20}}"&gt;All of the&lt;/text&gt;'</span>,
             <span class="st">'&lt;text x="{{cx}}" y="{{cy+90}}"&gt;Things&lt;/text&gt;'</span>,
             <span class="va">petals</span>, <span class="va">petal_fix</span>, <span class="va">text</span>, <span class="st">"&lt;/svg&gt;"</span>,
             sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span>.open <span class="op">=</span> <span class="st">"{{"</span>, .close <span class="op">=</span> <span class="st">"}}"</span><span class="op">)</span></code></pre></div>
<svg viewbox="0 0 1320 1320"><style type="text/css">
svg { 
  font-family: sans-serif;
  font-size: 80px; 
  text-anchor: middle; 
  fill: white;
}
</style>
<polygon points="503.63,535.3 660,460 816.37,535.3 854.99,704.5 746.78,840.19 573.22,840.19 465.01,704.5" fill="grey"></polygon><text x="660" y="640">All of the</text><text x="660" y="750">Things</text><circle cx="347.27" cy="410.6" r="200" fill="#FF0000"></circle><circle cx="660" cy="260" r="200" fill="#FFDB00"></circle><circle cx="972.73" cy="410.6" r="200" fill="#49FF00"></circle><circle cx="1049.97" cy="749.01" r="200" fill="#00FF92"></circle><circle cx="833.55" cy="1020.39" r="200" fill="#0092FF"></circle><circle cx="486.45" cy="1020.39" r="200" fill="#4900FF"></circle><circle cx="270.03" cy="749.01" r="200" fill="#FF00DB"></circle><g transform="rotate(218.571428571429, 347.27, 410.6)"><path d="M 147.27 410.6
A 200 200 0 0 1 547.27 410.6
L 147.27 410.6
Z" fill="#FF0000"></path></g><text x="347.27" y="450.6">A</text>"
<text x="660" y="300">B</text>"
<text x="972.73" y="450.6">C</text>"
<text x="1049.97" y="789.01">D</text>"
<text x="833.55" y="1060.39">E</text>"
<text x="486.45" y="1060.39">F</text>"
<text x="270.03" y="789.01">G</text>"
</svg>
</div>
<div id="make-a-function" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Make a Function<a class="anchor" aria-label="anchor" href="#make-a-function"><i class="fas fa-link"></i></a>
</h2>
<p>Now I just need to wrap this all in a function so I can change the things I need. I also added transparency to the petals, which necessitated making the two halves of the first petal separately, otherwise the overlap fix increases the opacity of half the petal if there's any transparency.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poly_coords</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">6</span>, <span class="va">r</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">cx</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">cy</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">rot</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_dbl</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="op">~</span><span class="op">{</span> <span class="va">cx</span> <span class="op">+</span> <span class="va">r</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">.x</span> <span class="op">/</span> <span class="va">n</span> <span class="op">+</span> <span class="va">rot</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>
  <span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_dbl</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="op">~</span><span class="op">{</span> <span class="va">cy</span> <span class="op">+</span> <span class="va">r</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">.x</span> <span class="op">/</span> <span class="va">n</span> <span class="op">+</span> <span class="va">rot</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">digits</span><span class="op">)</span>,
    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">digits</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">flower</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">6</span>, <span class="va">petal_dist</span> <span class="op">=</span> <span class="fl">500</span>, <span class="va">r</span> <span class="op">=</span> <span class="fl">250</span>, <span class="va">rot</span> <span class="op">=</span> <span class="op">-</span><span class="va">pi</span><span class="op">/</span><span class="fl">2</span>,
                   <span class="va">petal_text</span> <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span>,
                   <span class="va">center_text</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All of the"</span>, <span class="st">"Things"</span><span class="op">)</span>,
                   <span class="va">petal_text_size</span> <span class="op">=</span> <span class="va">r</span><span class="op">/</span><span class="fl">2</span>,
                   <span class="va">center_text_size</span> <span class="op">=</span> <span class="va">petal_dist</span><span class="op">/</span><span class="fl">6</span>,
                   <span class="va">center_text_offsets</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>, <span class="op">+</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">*</span> <span class="va">center_text_size</span>,
                   <span class="va">petal_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
                   <span class="va">petal_alpha</span> <span class="op">=</span> <span class="fl">1.0</span>,
                   <span class="va">center_color</span> <span class="op">=</span> <span class="st">"#808080"</span>,
                   <span class="va">petal_text_color</span> <span class="op">=</span> <span class="st">"white"</span>,
                   <span class="va">center_text_color</span> <span class="op">=</span> <span class="va">petal_text_color</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># calculate centre</span>
  <span class="va">cx</span> <span class="op">&lt;-</span> <span class="fl">1.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">petal_dist</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span>
  <span class="va">cy</span> <span class="op">&lt;-</span> <span class="va">cx</span>
  
  <span class="co"># make centre polygon</span>
  <span class="va">center</span> <span class="op">&lt;-</span> <span class="fu">poly_coords</span><span class="op">(</span><span class="va">n</span>, <span class="va">petal_dist</span><span class="op">-</span><span class="va">r</span>, <span class="va">cx</span>, <span class="va">cy</span>, <span class="va">rot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">"{cc$x},{cc$y}"</span>, cc <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'&lt;polygon points="{pts}" fill="{center_color}" /&gt;'</span>, pts <span class="op">=</span> <span class="va">.</span><span class="op">)</span>
  
  <span class="co"># make center texts</span>
  <span class="va">center_texts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;text x="{cx}" y="{cy+center_text_offsets}" fill="{center_text_color}" font-size="{center_text_size}px"&gt;{center_text}&lt;/text&gt;'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>
  
  <span class="co"># make petals</span>
  <span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu">poly_coords</span><span class="op">(</span><span class="va">n</span>, <span class="va">petal_dist</span>, <span class="va">cx</span>, <span class="va">cy</span>, <span class="va">rot</span><span class="op">)</span>
  <span class="va">petals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;circle cx="{coords$x}" cy="{coords$y}" r="{r}" fill="{petal_colors}" fill-opacity="{petal_alpha}" /&gt;'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>
  
  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">$</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">$</span><span class="va">y</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="va">petal_fix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;g transform="rotate({(rot+pi)*180/pi}, {x1}, {y1})"&gt;
         &lt;path d="M {x1-r} {y1}
         A {r} {r} 0 0 1 {x1+r} {y1}
         L {x1-r} {y1}
         Z" 
         fill="{petal_colors[[1]]}" fill-opacity="{petal_alpha}" /&gt;&lt;/g&gt;'</span><span class="op">)</span>
  
  <span class="va">petal_fix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;g transform="rotate({rot*180/pi}, {x1}, {y1})"&gt;
         &lt;path d="M {x1-r} {y1}
         A {r} {r} 0 0 1 {x1+r} {y1}
         L {x1-r} {y1}
         Z" 
         fill="{petal_colors[[1]]}" fill-opacity="{petal_alpha}" /&gt;&lt;/g&gt;'</span><span class="op">)</span>
  
  <span class="co"># make petal text</span>
  <span class="va">petals_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span><span class="st">'    &lt;text x="{coords$x}" y="{coords$y+petal_text_size/2}"&gt;{petal_text}&lt;/text&gt;'</span>, .literal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>
  
  <span class="co"># general styles</span>
  <span class="va">svg_style</span> <span class="op">&lt;-</span> <span class="st">'&lt;style type="text/css"&gt;
  svg { 
    font-family: sans-serif;
    font-size: {{petal_text_size}}px; 
    text-anchor: middle; 
    fill: {{petal_text_color}};
  }
&lt;/style&gt;'</span>
  
  <span class="va">svg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"&lt;svg viewBox = '0 0 {{2*cx}} {{2*cy}}'&gt;"</span>, 
               <span class="va">svg_style</span>,
               <span class="va">center</span>, <span class="va">center_texts</span>,
               <span class="va">petal_fix1</span>, <span class="va">petals</span>, <span class="va">petal_fix2</span>, <span class="va">petals_text</span>,
               <span class="st">"&lt;/svg&gt;"</span>,
               sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span><span class="op">(</span>.open <span class="op">=</span> <span class="st">"{{"</span>, .close <span class="op">=</span> <span class="st">"}}"</span><span class="op">)</span>
  
  <span class="va">svg</span>
<span class="op">}</span></code></pre></div>
<p>Test the defaults.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svg</span> <span class="op">&lt;-</span> <span class="fu">flower</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<svg viewbox="0 0 1000 1000"><circle cx="500" cy="200" r="200" fill="#FF0000"></circle><circle cx="759.81" cy="350" r="200" fill="#FFFF00"></circle><circle cx="759.81" cy="650" r="200" fill="#00FF00"></circle><circle cx="500" cy="800" r="200" fill="#00FFFF"></circle><circle cx="240.19" cy="650" r="200" fill="#0000FF"></circle><circle cx="240.19" cy="350" r="200" fill="#FF00FF"></circle></svg>
</div>
<div id="original-pride-flag" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Original Pride Flag<a class="anchor" aria-label="anchor" href="#original-pride-flag"><i class="fas fa-link"></i></a>
</h2>
<p>Test the customisability by making a chart with the meaning of the 8 colours of the original pride flag.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svg</span> <span class="op">&lt;-</span> <span class="fu">flower</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span>, petal_dist <span class="op">=</span> <span class="fl">400</span>, r <span class="op">=</span> <span class="fl">200</span>,
              petal_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FF66B1"</span>, <span class="st">"#FF0000"</span>, <span class="st">"#FF8F1A"</span>, <span class="st">"#FEFF3A"</span>,
                               <span class="st">"#008F1D"</span>, <span class="st">"#00C0C0"</span>, <span class="st">"#420095"</span>, <span class="st">"#8F008B"</span><span class="op">)</span>,
              petal_alpha <span class="op">=</span> <span class="fl">0.8</span>,
              petal_text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sex"</span>, <span class="st">"Life"</span>, <span class="st">"Healing"</span>, <span class="st">"Sunlight"</span>,
                             <span class="st">"Nature"</span>, <span class="st">"Magic/Art"</span>, <span class="st">"Serenity"</span>, <span class="st">"Spirit"</span><span class="op">)</span>,
              center_text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Original"</span>, <span class="st">"Pride"</span>, <span class="st">"Flag"</span><span class="op">)</span>,
              center_text_size <span class="op">=</span> <span class="fl">80</span>,
              center_text_offsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">60</span>, <span class="fl">40</span>, <span class="fl">140</span><span class="op">)</span>,
              petal_text_color <span class="op">=</span> <span class="st">"#222222"</span>,
              petal_text_size <span class="op">=</span> <span class="fl">70</span>,
              center_color <span class="op">=</span> <span class="st">"black"</span>,
              center_text_color <span class="op">=</span> <span class="st">"white"</span>
<span class="op">)</span></code></pre></div>
<svg viewbox="0 0 1000 1000"><circle cx="500" cy="200" r="200" fill="#FF0000"></circle><circle cx="759.81" cy="350" r="200" fill="#FFFF00"></circle><circle cx="759.81" cy="650" r="200" fill="#00FF00"></circle><circle cx="500" cy="800" r="200" fill="#00FFFF"></circle><circle cx="240.19" cy="650" r="200" fill="#0000FF"></circle><circle cx="240.19" cy="350" r="200" fill="#FF00FF"></circle><g transform="rotate(-90, 500, 200)"><path d="M 300 200
A 200 200 0 0 1 700 200
L 300 200
Z" fill="#FF0000"></path></g></svg>
</div>
<div id="save-as-svg-or-png" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Save as SVG or PNG<a class="anchor" aria-label="anchor" href="#save-as-svg-or-png"><i class="fas fa-link"></i></a>
</h2>
<p>You can display your SVG directly in a website by setting <code>results='asis'</code> in the code chunk header. It will display it full size unless you use another method to constrain the image size. I set a css style of <code>svg { width: 100%; }</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">svg</span><span class="op">)</span></code></pre></div>
<svg viewbox="0 0 1320 1320"><style type="text/css">
  svg { 
    font-family: sans-serif;
    font-size: 70px; 
    text-anchor: middle; 
    fill: #222222;
  }
</style>
<polygon points="660,460 801.42,518.58 860,660 801.42,801.42 660,860 518.58,801.42 460,660 518.58,518.58" fill="black"></polygon><text x="660" y="600" fill="white" font-size="80px">Original</text><text x="660" y="700" fill="white" font-size="80px">Pride</text><text x="660" y="800" fill="white" font-size="80px">Flag</text><g transform="rotate(90, 660, 260)"><path d="M 460 260
A 200 200 0 0 1 860 260
L 460 260
Z" fill="#FF66B1" fill-opacity="0.8"></path></g><circle cx="660" cy="260" r="200" fill="#FF66B1" fill-opacity="0.8"></circle><circle cx="942.84" cy="377.16" r="200" fill="#FF0000" fill-opacity="0.8"></circle><circle cx="1060" cy="660" r="200" fill="#FF8F1A" fill-opacity="0.8"></circle><circle cx="942.84" cy="942.84" r="200" fill="#FEFF3A" fill-opacity="0.8"></circle><circle cx="660" cy="1060" r="200" fill="#008F1D" fill-opacity="0.8"></circle><circle cx="377.16" cy="942.84" r="200" fill="#00C0C0" fill-opacity="0.8"></circle><circle cx="260" cy="660" r="200" fill="#420095" fill-opacity="0.8"></circle><circle cx="377.16" cy="377.16" r="200" fill="#8F008B" fill-opacity="0.8"></circle><g transform="rotate(-90, 660, 260)"><path d="M 460 260
A 200 200 0 0 1 860 260
L 460 260
Z" fill="#FF66B1" fill-opacity="0.8"></path></g><text x="660" y="295">Sex</text><text x="942.84" y="412.16">Life</text><text x="1060" y="695">Healing</text><text x="942.84" y="977.84">Sunlight</text><text x="660" y="1095">Nature</text><text x="377.16" y="977.84">Magic/Art</text><text x="260" y="695">Serenity</text><text x="377.16" y="412.16">Spirit</text></svg><p>You can write it to an svg file, or use svgr to convert to an image.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/write.html">write</a></span><span class="op">(</span><span class="va">svg</span>, <span class="st">"images/day4.svg"</span><span class="op">)</span>
<span class="fu">rsvg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rsvg/man/rsvg.html">rsvg_png</a></span><span class="op">(</span>svg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html">charToRaw</a></span><span class="op">(</span><span class="va">svg</span><span class="op">)</span>, 
               file <span class="op">=</span> <span class="st">"images/day4.png"</span>, 
               width <span class="op">=</span> <span class="fl">8</span><span class="op">*</span><span class="fl">150</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">*</span><span class="fl">150</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"images/day4.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/day4.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    license + cite
  );

  // open rdrr links externally
  $("a[href^='https://rdrr.io']").click(function(){
    window.open(this.href);
    return false;
  });

  // visible second sidebar in mobile
  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="historical.html"><span class="header-section-number">3</span> Historical</a></div>
<div class="next"><a href="slope.html"><span class="header-section-number">5</span> Slope</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#flora"><span class="header-section-number">4</span> Flora</a></li>
<li><a class="nav-link" href="#svg"><span class="header-section-number">4.1</span> SVG</a></li>
<li><a class="nav-link" href="#flower-petals"><span class="header-section-number">4.2</span> Flower Petals</a></li>
<li><a class="nav-link" href="#rotate"><span class="header-section-number">4.3</span> Rotate</a></li>
<li><a class="nav-link" href="#fix-the-overlap"><span class="header-section-number">4.4</span> Fix the Overlap</a></li>
<li><a class="nav-link" href="#petals"><span class="header-section-number">4.5</span> 7 Petals</a></li>
<li><a class="nav-link" href="#make-a-function"><span class="header-section-number">4.6</span> Make a Function</a></li>
<li><a class="nav-link" href="#original-pride-flag"><span class="header-section-number">4.7</span> Original Pride Flag</a></li>
<li><a class="nav-link" href="#save-as-svg-or-png"><span class="header-section-number">4.8</span> Save as SVG or PNG</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/debruine/30-day-chart-challenge/blob/master/book/01-comparisons.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/debruine/30-day-chart-challenge/edit/master/book/01-comparisons.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>30-day Chart Challenge</strong>: 2022" was written by Lisa DeBruine. It was last built on 2022-04-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
